(()=>{"use strict";const e={CCPA:"__uspapi",GDPR:"__tcfapi",GPP:"__gpp"},t={GDPR:"__tcfapiLocator",CCPA:"__uspapiLocator",GPP:"__gppLocator"},n={GDPR:["addEventListener"],CCPA:["getUSPData"],GPP:["ping","addEventListener"]},o="iab",s="static",r={GDPR:2,CCPA:1},i={GDPR(e,t,n){e(t,r.GDPR,n)},CCPA(e,t,n){e(t,r.CCPA,n)},GPP(e,t,n,o){e(t,n,o)}};class a{#e;#t;#n;#o;#s;#r;#i;#a;constructor(t){let{name:n,win:o=window,config:s={},hashFn:r}=t;this.#e=n,this.#t=e[n],this.#o=o,this.#s=s.consentTimeout||1e4,this.#r=this.#o._33across?.idMappingsConfig?.regs?.[this.#e.toLowerCase()],this.#a=r}#c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.#o;try{if("function"==typeof t[this.#t])return{cmpApi:t[this.#t],win:t};if(t.frames[e])return{win:t}}catch(e){}return t===this.#o.top?{}:this.#c(e,t.parent)}#l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t="boolean"==typeof e.gdprApplies&&e.gdprApplies;return!t||(n=e.tcString)&&"string"==typeof n?{consentData:this.#p({consentString:e.tcString,consentObject:e,additionalFields:{applies:t,..."string"==typeof e.addtlConsent?{addtlConsent:e.addtlConsent}:{}},valuesToHash:[t,e.tcString]})}:this.#d(e);var n}#h(e){return t=e?.uspString,t&&"string"==typeof t?{consentData:this.#p({consentString:e.uspString,consentObject:e,valuesToHash:e.uspString})}:this.#d(e);var t}#d(e){return this.#u("CMP returned unexpected value during lookup process.",{consentObject:e})}#u(e,t){return{errMsg:e,errArgs:t,consentData:this.#p()}}#g(e){const t=e=>Array.isArray(e)&&e.length>0&&0!==e[0];return t(e.applicableSections)?e.applicableSections:t(e.applicableSection)?e.applicableSection:null}#m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Object.assign({},e,e.pingData);if(!t.gppString||"string"!=typeof t.gppString)return this.#d(t);const n=this.#g(t);return n?{consentData:this.#p({consentString:t.gppString,apiVersion:t.gppVersion,consentObject:t,additionalFields:{applicableSections:n},valuesToHash:[n,t.gppString]})}:this.#d(t)}#p(){let{consentString:e="",consentObject:t={},apiVersion:n=r[this.#e],additionalFields:o,valuesToHash:s=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{consentString:e,vendorData:t,apiVersion:n,name:this.#e,hash:this.#a(JSON.stringify(s)),...o}}#f(e,t){const n={GDPR:e=>this.#l(e),CCPA:e=>this.#h(e),GPP:e=>this.#m(e)}[this.#e](e);return t&&this.#i?.(n,this.#e),n}#w(e,t){switch(this.#e){case"GDPR":return[!1===e.gdprApplies||"tcloaded"===e.eventStatus||"useractioncomplete"===e.eventStatus];case"CCPA":return[!0];case"GPP":{if("sectionChange"===e.eventName)return[!0,!0];const n=e.pingData||e;return"loaded"===n.cmpStatus?n.gppString||e.hasOwnProperty("gppString")?[!0]:(this.#S("getGPPData").then(t),[!1]):"ready"===n.signalStatus?[!0]:"error"===n.cmpStatus?[!1,!1,"CMP returned with a cmpStatus:error response. Please check CMP setup."]:[!1]}default:return[!1]}}#v(e,t){if(arguments.length>2&&void 0!==arguments[2]&&!arguments[2])return void e(this.#u("CMP unable to register callback function.  Please check CMP setup."));const[n,o,s]=this.#w(t,e);n?e(this.#f(t,o)):s?e({errMsg:s}):this.#n=t}#C(e,t){const n=`${this.#t}Return`,o=(e.data?.includes?.(n)?JSON.parse(e.data):e.data)[n];o?.callId&&(t[o.callId]?.(o.returnValue,o.success),delete t[o.callId])}#I(e,t,n){const o={},s=`${this.#t}Call`;this.#o.addEventListener("message",(e=>this.#C(e,o)),!1),function(e,n,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=Math.random().toString(),c={[s]:Object.assign({command:e,callId:a},n&&{version:n},i&&{parameter:i})};o[a]=r,t.postMessage(c,"*")}(e,r[this.#e],n)}#S(e){var n=this;return new Promise((o=>{const{cmpApi:s,win:r}=this.#c(t[this.#e]);if(!r)return void o(this.#u("CMP not found, the CMP script needs to be loaded before the 33across script"));const a=function(){o.fnName=e;for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];n.#v(o,...s)};s?i[this.#e](s,e,a):this.#I(e,r,a)}))}#P(){return this.#f(this.#r)}onChange(e){this.#i=e}loadConsentData(){const e=this.#r?s:"iab",t={[o]:()=>n[this.#e].map((e=>this.#S(e))),[s]:()=>[this.#P()]};let r=null;const i=new Promise((e=>{r=this.#o.setTimeout((()=>{const{consentData:t,errMsg:n}=this.#f(this.#n);e(Object.assign(this.#u("CMP hasn't been loaded"),{consentData:n?this.#p():t}))}),this.#s)}));return Promise.race([...t[e](),i]).finally((()=>this.#o.clearTimeout(r)))}}const c="33acrossId_csti",l="COPPA",p=["GDPR","CCPA","GPP"],d=p.concat([l]);function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=function(e,t){if("function"==typeof Math.imul)return Math.imul(e,t);let n=(4194303&e)*(t|=0);return 4290772992&e&&(n+=(4290772992&e)*t|0),0|n};let o=3735928559^t,s=1103547991^t;for(let t,r=0;r<e.length;r++)t=e.charCodeAt(r),o=n(o^t,2654435761),s=n(s^t,1597334677);return o=n(o^o>>>16,2246822507)^n(s^s>>>13,3266489909),s=n(s^s>>>16,2246822507)^n(o^o>>>13,3266489909),(4294967296*(2097151&s)+(o>>>0)).toString()}const u=31536e6;class g{#o;#b;#y;#D;constructor(e,t){let{win:n=window,cookieExpirationInMs:o=u}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.#o=n,this.#b=t,this.#y=e,this.#D=o}#x(e){const t=new Date(Date.now()+this.#D);return this.#b.setCookie({win:this.#o,key:this.#y,value:e,expires:t.toUTCString(),domain:this.#b.calculateTopMostCookieableDomain(this.#o)}),this}#k(e){return this.#o.localStorage.setItem(this.#y,e),this}#E(e,t){return e&&!t?this.#x(e):t&&!e&&this.#k(t),this}setId(e){return this.#k(e),this.#b.hasCookieSupport(this.#o)&&this.#x(e),this}getId(){const e=this.#o.localStorage.getItem(this.#y);if(!this.#b.hasCookieSupport(this.#o))return e;const t=this.#b.getCookie(this.#y);return this.#E(e,t),e||t}clear(){return this.#o.localStorage.removeItem(this.#y),this.#b.hasCookieSupport(this.#o)&&this.#b.removeCookie(this.#y,this.#b.calculateTopMostCookieableDomain(this.#o),this.#o),this}}function m(e){let{key:t,value:n,expires:o,sameSite:s="",domain:r,win:i=window}=e;const a=r?` ;domain=${encodeURIComponent(r)}`:"",c=o?` ;expires=${o}`:"",l="none"===s.toLowerCase()?"; Secure":"",p=s?`; SameSite=${s}`:"";i.document.cookie=`${t}=${encodeURIComponent(n)}${c}; path=/${a}${p}${l}`}function f(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:window).document.cookie.match(`(^|;)\\s*${e}\\s*=\\s*([^;]*)\\s*(;|$)`);return t?decodeURIComponent(t[2]):null}function w(e,t){m({win:arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,key:e,value:"",expires:"Thu, 01 Jan 1970 00:00:01 GMT",domain:t})}const S={setCookie:m,getCookie:f,removeCookie:w,calculateTopMostCookieableDomain:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=e.document.domain.split("."),n=`_gd${Date.now()}_`;let o;for(let s,r=0;r<t.length;r++){const i=t.slice(r).join(".");if(m({win:e,key:n,value:"1",domain:i}),s=f(n,e),w(n,i,e),"1"!==s)break;o=i}return o},hasCookieSupport:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).navigator.cookieEnabled}};function v(e){return new Promise(((t,n)=>{const o=function(e){let{url:t,params:n={},win:o=window,options:s={}}=e;const r=new o.XMLHttpRequest("MSXML2.XMLHTTP.3.0"),i=new URLSearchParams(n);return r.open("GET",`${t}?${i}`,1),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.withCredentials=void 0!==s.withCredentials,r.timeout=s.timeout,r}(e);o.onreadystatechange=()=>{4===o.readyState&&(o.status>=200&&o.status<300?t(o.responseText):n(`Ajax: Status code ${o.status}`))},o.onerror=()=>n("Ajax: Network error"),o.ontimeout=()=>n("Ajax: Timeout"),o.send()}))}const C=28800,I=30;class P{#M;#L;#o;#R;constructor(e){let{idKeyName:t,refreshInSeconds:n=C,expires:o=I,win:s=window}=e;this.#M={VALUE:t,LAST:`${t}_last`,EXP:`${t}_exp`},this.#o=s,this.#L=n,this.#R=864e5*o}#A(e,t){return this.#o.localStorage.setItem(e,t),this}#$(e){return this.#o.localStorage.removeItem(e),this}#j(e){return this.#o.localStorage.getItem(e)}hasExpired(){const e=this.#j(this.#M.EXP);return!!e&&new Date(e).getTime()-Date.now()<=0}isRefreshRequired(){const e=this.#j(this.#M.LAST);return!e||Date.now()-new Date(e).getTime()>=1e3*this.#L}setId(e){const t=new Date(Date.now()+this.#R),n=new Date;this.#A(this.#M.VALUE,e).#A(this.#M.EXP,t.toUTCString()).#A(this.#M.LAST,n.toUTCString())}getId(){return this.#o.decodeURIComponent(this.#j(this.#M.VALUE)||"")}clear(){return this.#$(this.#M.VALUE).#$(this.#M.EXP).#$(this.#M.LAST),this}}const b=[{level:"error",color:"red"},{level:"warn",color:"yellow"},{level:"info",color:"green"},{level:"debug",color:"cyan"},{level:"trace",color:"blue"}],y="display: inline-block; padding: 1px 4px;",D="3px",x={core:y,bordersize:D,prefix:`${y}\n    border-top-left-radius: ${D};\n    border-bottom-left-radius: ${D};\n    color: #fff;\n    background-color: #be1e2d;\n  `,product:`${y}\n    border-top-right-radius: ${D};\n    border-bottom-right-radius: ${D};\n    color: #000;\n    background-color: #f2f2f2;\n    font-weight: lighter;\n    font-size: 0.9em;\n  `,baseLvl:`${y}\n    border-radius: ${D};\n    background-color: black;\n  `,date:`${y} color:grey;`};function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!(e instanceof Object))throw new Error(`Invalid target type. Expected an object, but got: ${e}`);const o=e.name||e.constructor.name||"???";return new Proxy(e,{get(e,r){if("function"==typeof e)return e[r];const i=e[r];if("object"==typeof i&&null!==i)return k(i,t,n);const a=`${o}.${String(r)}`;return"function"==typeof i?s(i,e,a):(t.print(4,n,`${a}:`,i),i)},set:(e,s,r,i)=>(t.print(4,n,`${o}.${String(s)} <=`,r),Reflect.set(e,s,r,i)),deleteProperty:(e,s)=>(t.print(4,n,`delete ${o}.${String(s)} (denied)`),!1),apply:(e,t,n)=>s(e,t,o)(...n),construct(e,s){const r=`new ${o}`;t.print(4,n,`construct ${r}`,...s);const i=Reflect.construct(e,s);return t.print(3,n+1,r,i),k(i,t,n)}});function s(e,o,s){return function(){let r=`${s}(`;for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];a.length||(r+=")"),t.print(4,n,r,...a);const l=e=>(t.print(3,n+1,`${r} =>`,e),e),p=e=>{if(t.print(0,n+1,r,e),e.propagate)throw delete e.propagate,e};try{const t=Reflect.apply(e,o,a);return"function"==typeof t?.then?t.then(l,p):l(t)}catch(e){return p(e)}}}}class E{#U=-1;get level(){return b[this.#U]?.level||"silent"}#T="33across";#G="Lexicon";#_=null;#O=console;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.#G=e.product??this.#G,this.#T=e.prefix??this.#T,this.#_=e.customHandler??this.#_,this.#O=e.baseLogger??this.#O}setLogLevel=e=>{this.#U=b.findIndex((t=>t.level===e))};wrap(e){return k(e,this)}error=(()=>{var e=this;return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.print(0,1,...n)}})();warn=(()=>{var e=this;return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.print(1,1,...n)}})();info=(()=>{var e=this;return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.print(2,1,...n)}})();debug=(()=>{var e=this;return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.print(3,1,...n)}})();trace=(()=>{var e=this;return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.print(4,1,...n)}})();print=(()=>{var e=this;return function(t,n){if(e.#U<t)return;const o=e.#H(n),{color:s,level:r}=b[t];for(var i=arguments.length,a=new Array(i>2?i-2:0),c=2;c<i;c++)a[c-2]=arguments[c];if(e.#O[r]("%c%s|%c%s %c%d %c%s %c%s",x.prefix,e.#T,x.product,e.#G,x.date,Date.now(),`${x.baseLvl} color: ${s}`,r,x.core,o,...a),e.#_)try{e.#_(t,n,...a)}catch(t){e.#O.error("Error in custom log handler:",t)}}})();#H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=((new Error).stack||"").split("\n");"Error"===t[0]&&e++;const n=t[2+e],o=/at\s+(.*)\s+\(/.exec(n)||/(.*)@/.exec(n);return o?o[1]:""}}const M=(e,t)=>new g(e,S,t),L="https://lexicon.33across.com/v1/envelope",R="ima",A={GDPR:e=>{let{consentString:t}=e;return{gdpr_consent:t}},CCPA:e=>{let{consentString:t}=e;return{us_privacy:t}},GPP:e=>{let{consentString:t,applicableSections:n=[]}=e;return{gpp:t,gpp_sid:encodeURIComponent(n.join(","))}}};class ${#V;#N;#K;#F=[];#q=[];#X;#J;#z;#o;#B;#Q;constructor(e,t){let{pid:n,apiUrl:o=L,src:s=R,win:r=window}=e,{ajax:i=v,consentDataHandler:a={consentData:Promise.resolve([])},localStorageId:c,firstPartyIdStorageManager:l,lexIdStorageManager:p}=t;this.#V=n,this.#N=o,this.#K=i,this.#X=a,this.#J=s,this.#z=c,this.#o=r,this.#B=l,this.#Q=p}#W(e){const t=JSON.parse(e);return t.succeeded?{idEnvelope:t.data.envelope||"",fpId:t.data.fp||"",tpId:t.data.tp||""}:{idEnvelope:"",fpId:"",tpId:""}}async#Y(e){const{idEnvelope:t,fpId:n,tpId:o}=await this.#Z(e);return n?this.#B.setId(n):this.#B.clear(),o?this.#Q.setId(o):this.#Q.clear(),t?(this.#z.setId(t),this.#ee(t)):(this.#z.clear(),[])}async#Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.#X.consentData;try{const t=await this.#K({url:this.#N,params:this.#te({allConsentData:await e,fp:this.#B.getId(),tp:this.#Q.getId()}),options:{withCredentials:!0,timeout:1e4}});return this.#W(t)}catch(e){throw new Error(`_33AcrossIdMappingsProvider: ${e}`)}}#te(e){let{allConsentData:t,fp:n,tp:o}=e;return t.reduce(((e,t)=>{let{consentData:n={}}=t;const o=A[n.name];return n.consentString&&o&&Object.assign(e,o(n)),e}),{pid:this.#V,src:this.#J,ver:"1.12.2",...n&&{fp:this.#o.decodeURIComponent(n)},...o&&{tp:this.#o.decodeURIComponent(o)},...Number(this.#o._33across?.idMappingsConfig?.regs?.coppa)&&{coppa:1}})}#ee(e){const[t]=this.#q,[n]=t.uids;return Object.assign(n,{id:e,atype:1}),this.#F=this.#q,this.#F}async fetch(){this.#q=[{source:"33across.com",uids:[{}]}],this.#X.onChange((e=>{this.#z.clear(),this.#Y(e)}));const e=this.#z.getId(),t=await this.#X.hasChangedSinceStored();return this.#z.hasExpired()||!e||t?this.#Y():(this.#z.isRefreshRequired()&&this.#Y(),this.#ee(e))}getIds(){return this.#F}getLoadingIds(){return this.#q}getPid(){return this.#V}getSource(){return this.#J}}const j=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;const o={},s=p.reduce(((t,n)=>Object.assign(t,{[n]:e(n)})),{}),r=Number(!!n._33across?.idMappingsConfig?.regs?.coppa),i=()=>p.map((e=>o[e]?.consentData.hash)).concat(r).join(":"),a=(e,t)=>{o[e]=t,n.localStorage.setItem(c,i())},h=()=>n.localStorage.getItem(c)?.split(":")||[],u=h();let g;return{onChange(e){s.GPP.onChange((t=>{const n=d.indexOf("GPP"),s=h()[n];t.consentData?.hash!==s&&(a("GPP",t),e(Object.values(o)))}))},consentData:new Promise((e=>{const t=Object.entries(s).reduce(((e,t)=>{let[n,o]=t;return(e[n]=o.loadConsentData()).then((e=>a(n,e))),e}),{});Promise.all(Object.values(t)).then((()=>e(Object.values(o)))),t.GPP.then((t=>{t.consentData?.consentString&&e(Object.values(o))}))})),getChangedSinceStoredResult:()=>g,async hasChangedSinceStored(){const e=n.localStorage.getItem("33acrossId_cst");return!u&&!e||(void 0!==g||(await this.consentData,g=(!e||t(i())!==e)&&(()=>{const e=d.reduce(((e,t,n)=>Object.assign(e,{[t]:u[n]})),{});return!!Object.entries(o).find((t=>{let[n,{consentData:o}]=t;const s=o.hash||"";return!(!e[n]&&!o.consentString)&&s!==e[n]}))||String(r)!==(e[l]??"0")})()),g)}}}((e=>new a({name:e,hashFn:h})),(function(e){return function(e){const t=[];for(;e>0;)t.push(String.fromCharCode(255&e)),e>>>=8;return btoa(t.join())}(h(e))})),U="33acrossId",T=function e(t){let{expires:n,refreshInSeconds:o,...s}=t;const r="esp"===s.src?`${s.src}_${U}`:U,i=function(){let{uri:e,level:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=(()=>{try{return new URL(e||globalThis.location.href).searchParams}catch{return null}})(),s=o?.get("lex_debug")||"silent",r=t||s,i=new E(n);return i.setLogLevel(r),i}({product:"Lexicon ID Mappings Provider"}),a=new(i.wrap(P))({idKeyName:r,expires:n,refreshInSeconds:o}),c=new(i.wrap($))(s,{consentDataHandler:j,localStorageId:a,firstPartyIdStorageManager:M("33acrossIdFp",{win:s.win}),lexIdStorageManager:M("33acrossIdTp",{win:s.win})});return"providers"in e||Object.assign(e,{providers:{}}),Object.assign(e.providers,{[r]:c}),c};function G(e){return e._33across?.idMappingsConfig.pid}!async function(){const e=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=G(e);return t?Promise.resolve(t):(function(e,t){!function(e,t,n){const o="_33across.idMappingsConfig.pid".split(".");o.reduce(((e,t,s)=>s===o.length-1?(e[t]=n,n):void 0===e[t]?(e[t]={},e[t]):e[t]),e)}(t,0,e)}(await function(e){return new Promise((t=>{e.setTimeout((async()=>{t(await function(e){return new Promise((t=>{e.pbjs&&e.pbjs.que?e.pbjs.que.push((()=>{t(e.pbjs?.getConfig("userSync.userIds")?.find((e=>{let{name:t}=e;return"33acrossId"===t}))?.params.pid)})):t()}))}(e)||function(e){const t=e._33AcrossIdMappingsProvider?.providers||{},n=t.ima||e._33AcrossPpidMappingsProvider?.providers[0]||t.aps;return n?.getPid()}(e))}),10)}))}(e),e),G(e))}();e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;t.googletag??={},t.googletag.secureSignalProviders??=[],t.googletag.secureSignalProviders.push({id:"33across.com",collectorFunction:()=>e.fetch().then((e=>e[0]?.uids[0].id||null))})}(T({src:"esp",pid:e})):console.error("33Across Lexicon ID Mappings Provider: PID not found")}()})();
//# sourceMappingURL=ob.js.map